import{_ as i,W as l,X as n,Y as e,Z as r,$ as t,a2 as h,C as o}from"./framework-7d1f27fd.js";const s={},p=h('<h1 id="缓存穿透、击穿、雪崩" tabindex="-1"><a class="header-anchor" href="#缓存穿透、击穿、雪崩" aria-hidden="true">#</a> 缓存穿透、击穿、雪崩</h1><h2 id="穿透" tabindex="-1"><a class="header-anchor" href="#穿透" aria-hidden="true">#</a> 穿透</h2><p>缓存穿透是指：缓存和数据库都没有的数据，被大量请求，比如订单号不可能为-1，但是用户请求了大量订单号为-1的数据，由于数据不存在，缓存就也不会存在该数据，所有的请求都会直接穿透到数据库。 如果被恶意用户利用，疯狂请求不存在的数据，就会导致数据库压力过大，甚至垮掉。</p><blockquote><p>注意：穿透的意思是，都没有，直接一路打到数据库。</p></blockquote><h4 id="缓存穿透的解决方案" tabindex="-1"><a class="header-anchor" href="#缓存穿透的解决方案" aria-hidden="true">#</a> 缓存穿透的解决方案</h4><ol><li><p>接口增加业务层级的Filter，进行合法校验，这可以有效拦截大部分不合法的请求。</p><p>作为第一点的补充，最常见的是使用布隆过滤器，针对一个或者多个维度，把可能存在的数据值hash到bitmap中，bitmap证明该数据不存在则该数据一定不存在，但是bitmap证明该数据存在也只能是可能存在，因为不同的数值hash到的bit位很有可能是一样的，hash冲突会导致误判，多个hash方法也只能是降低冲突的概率，无法做到避免。</p></li><li><p>另外一个常见的方法，则是针对数据库与缓存都没有的数据，对空的结果进行缓存，但是过期时间设置得较短，一般五分钟内。而这种数据，如果数据库有写入，或者更新，必须同时刷新缓存，否则会导致不一致的问题存在。</p></li></ol><h2 id="击穿" tabindex="-1"><a class="header-anchor" href="#击穿" aria-hidden="true">#</a> 击穿</h2><p>缓存击穿是指：数据库原本有得数据，但是缓存中没有，一般是缓存突然失效了，这时候如果有大量用户请求该数据，缓存没有则会去数据库请求，会引发数据库压力增大，可能会瞬间打垮。</p><p>针对这类问题，一般有以下做法：</p><ol><li><p>如果是热点数据，那么可以考虑设置永远不过期。</p></li><li><p>如果数据一定会过期，那么就需要在数据为空的时候，设置一个互斥的锁，只让一个请求通过，只有一个请求去数据库拉取数据（取完数据，不管如何都需要释放锁，异常的时候也需要释放锁，要不其他线程会一直拿不到锁）。</p></li></ol><h2 id="雪崩" tabindex="-1"><a class="header-anchor" href="#雪崩" aria-hidden="true">#</a> 雪崩</h2><p>缓存雪崩是指缓存中有大量的数据，在同一个时间点，或者较短的时间段内，全部过期了，这个时候请求过来，缓存没有数据，都会请求数据库，则数据库的压力就会突增，扛不住就会宕机。</p><p>针对这种情况，一般我们都是使用以下方案：</p><ol><li><p>如果是热点数据，那么可以考虑设置永远不过期。</p></li><li><p>缓存的过期时间除非比较严格，要不考虑设置一个波动随机值，比如理论十分钟，那这类key的缓存时间都加上一个1<sub>3分钟的浮动，过期时间在7</sub>13分钟内波动，有效防止都在同一个时间点上大量过期。</p></li><li><p>方法1避免了有效过期的情况，但是要是所有的热点数据在一台redis服务器上，也是极其危险的，如果网络有问题，或者redis服务器挂了，那么所有的热点数据也会雪崩（查询不到），因此将热点数据打散分不到不同的机房中，也可以有效减少这种情况。</p></li><li><p><s>也可以考虑双缓存的方式，数据库数据同步到缓存A和B，A设置过期时间，B不设置过期时间，如果A为空的时候去读B，同时异步去更新缓存，但是更新的时候需要同时更新两个缓存。</s></p></li></ol><h4 id="引用" tabindex="-1"><a class="header-anchor" href="#引用" aria-hidden="true">#</a> 引用</h4>',15),c={href:"https://segmentfault.com/a/1190000039688578",target:"_blank",rel:"noopener noreferrer"},d={href:"https://learnku.com/articles/28772#aa940b",target:"_blank",rel:"noopener noreferrer"};function _(u,f){const a=o("ExternalLinkIcon");return l(),n("div",null,[p,e("p",null,[e("a",c,[r("https://segmentfault.com/a/1190000039688578"),t(a)])]),e("p",null,[e("a",d,[r("https://learnku.com/articles/28772#aa940b"),t(a)])])])}const m=i(s,[["render",_],["__file","缓存穿透、击穿、雪崩.html.vue"]]);export{m as default};
