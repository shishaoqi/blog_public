import{_ as p,W as a,X as e,a2 as i}from"./framework-7d1f27fd.js";const r="data:image/png;base64,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",t="/article/docs/assets/请求php文件-44da5b12.png",A="/article/docs/assets/http到nginx-php-13475901.png",h={},l=i('<h1 id="fpm" tabindex="-1"><a class="header-anchor" href="#fpm" aria-hidden="true">#</a> FPM</h1><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><p>在整个网站架构中，Web Server（如Apache、Nginx）只是内容的分发者。举个栗子，如果客户端请求的是 index.html，那么Web Server会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。 <img src="'+r+'" alt="网络体系结构-图1" loading="lazy"></p><p>如果请求的是 index.php，根据配置文件，Web Server知道这个不是静态文件，需要去找 PHP 解析器来处理，那么他会把这个请求简单处理，然后交给PHP解析器。 当Web Server收到index.php 这个请求后，会启动对应的 CGI 程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定CGI规定的格式返回处理后的结果，退出进程，Web server再把结果返回给浏览器。这就是一个完整的动态PHP Web访问流程（接下来再引出下的概念，会好理解很多）。 <img src="'+t+'" alt="网络体系结构-图1" loading="lazy"></p><ul><li><p>CGI：是 Web Server 与 Web Application 之间数据交换的一种协议。</p></li><li><p>FastCGI：同 CGI，是一种通信协议，但比 CGI 在效率上做了一些优化。</p></li><li><p>PHP-CGI：是 PHP （Web Application）对 Web Server 提供的 CGI 协议的接口程序。</p></li><li><p>PHP-FPM：是 PHP（Web Application）对 Web Server 提供的 FastCGI 协议的接口程序，额外还提供了相对智能一些任务管理。</p></li></ul><blockquote><p>（Web Server 一般指Apache、Nginx、IIS、Tomcat等服务器，Web Application 一般指PHP、Java、Asp.net等应用程序）</p></blockquote><p><strong>简单的综合描述:</strong>（二选一）<br> 在网络应用场景下，PHP并没有像Golang那样实现http网络库，而是实现了FastCGI协议，然后与web服务器配合实现了http的处理，web服务器来接收http请求，然后将<code>解析的结果</code>再通过<code>FastCGI协议</code>转发给处理程序，处理程序处理完成后将结果返回给web服务器，web服务器再返回给用户，如下图所示。 <img src="'+A+'" alt="网络体系结构-图1" loading="lazy"></p><h2 id="fpm-1" tabindex="-1"><a class="header-anchor" href="#fpm-1" aria-hidden="true">#</a> FPM</h2><p>FPM(FastCGI Process Manager)是 PHP FastCGI 运行模式的一个<code>进程管理器</code>，从它的定义可以看出，FPM的核心功能是进程管理，那么它用来管理什么进程呢？这个问题就需要从CGI、FastCGI说起了。</p><h2 id="cgi" tabindex="-1"><a class="header-anchor" href="#cgi" aria-hidden="true">#</a> CGI</h2><p>CGI的英文是（Common Gateway Interface）公共网关接口，它的作用就是帮助服务器与语言通信，这里就是nginx和php进行通信，因为nginx和php的语言不通，因此需要一个沟通转换的过程，而CGI就是这个沟通的协议。</p><p>nginx服务器在接受到浏览器传递过来的数据后，如果请求的是静态的页面或者图片等无需动态处理的则会直接根据请求的url找到其位置然后返回给浏览器，这里无需php参与；但是如果是一个动态的页面请求，这个时候nginx就必须与php通信，这个时候就会需要用到CGI协议，将请求数据转换成php能理解的信息，然后php根据这些信息返回的信息也要通过CGI协议转换成nginx可以理解的信息，最后nginx接到这些信息再返回给浏览器。</p><h2 id="fastcgi" tabindex="-1"><a class="header-anchor" href="#fastcgi" aria-hidden="true">#</a> FastCGI</h2><p>FastCGI 是Web服务器(如：Nginx、Apache)和处理程序之间的一种通信协议，它是与Http类似的一种应用层通信协议，注意：它只是一种协议！</p><h4 id="有了cgi协议-为什么还搞个fastcgi协议" tabindex="-1"><a class="header-anchor" href="#有了cgi协议-为什么还搞个fastcgi协议" aria-hidden="true">#</a> 有了CGI协议，为什么还搞个FastCGI协议</h4><p>CGI：当收到web server请求后，会启动对应的CGI程序，这里就是PHP的解析器（php-cgi）。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定的CGI规定的格式返回处理后的结果，退出进程。（CGI每次接收到请求都会执行这些步骤）</p><p>FastCGI：首先，FastCGI程序会先启动一个master，解析配置环境，初始化执行环境，然后再启动多个worker。当请求过来时，master会传递给一个worker，然后立即可以接受下一个请求。这样就避免了重复的初始化工作，效率自然是高。而且当worker不够用时，master可以根据配置预先启动几个worker等着；当然空闲worker太多时，也会停掉一些，从而提高了性能或节约了资源，这就是FastCGI对进程的管理。（CGI程序和FastCGI程序，可以理解成遵循CGI协议和FastCGI协议编写的程序）</p><h2 id="php-cgi" tabindex="-1"><a class="header-anchor" href="#php-cgi" aria-hidden="true">#</a> PHP-CGI</h2><p>PHP-CGI：是 PHP （Web Application）对 Web Server 提供的 CGI 协议的接口程序。</p><h2 id="php-fpm" tabindex="-1"><a class="header-anchor" href="#php-fpm" aria-hidden="true">#</a> PHP-FPM</h2><p>再次声明：FastCGI 是一个协议，PHP-FPM 实现了这个协议。</p><p>大家都知道，PHP的解释器是 PHP-CGI。PHP-CGI 只是个CGI程序，他自己本身只能解析请求，返回结果，不会进程管理，所以就出现了一些能够调度 PHP-CGI 进程的程序，PHP-FPM 就是这样的一个东西。</p><p>PHP-FPM 的管理对象是 PHP-CGI。</p><p>PHP-FPM 克服了 PHP-CGI 在变更php.ini配置后，需重启 PHP-CGI 才能让新的配置生效，不可以平滑重启，直接杀死 PHP-CGI 进程，php就不能运行了的问题。修改php.ini之后，php-cgi进程的确没办法平滑重启的。PHP-FPM 对此的处理机制是新的worker用新的配置，已经存在的 worker 处理完手上的活就消亡，通过这种机制来平滑过度。</p><h4 id="php-fpm-平滑重启" tabindex="-1"><a class="header-anchor" href="#php-fpm-平滑重启" aria-hidden="true">#</a> php-fpm 平滑重启</h4><ul><li><p>php-fpm的reload平滑重启是指：假设128个php-cgi进程中有50个进程正在处理PHP程序，而剩余的78个进程处于闲置状态，php-fpm接到平滑重启信号后，会kill掉78个闲置进程，然后新启动128个进程，新请求交给新启动的进程来处理，而那50个进程，只有等到它们处理完自己当前正在执行的PHP程序后，才会被干掉。</p></li><li><p>php-fpm master 进程可以理解以下的信号：</p><ul><li>INT, TERM 立刻终止</li><li>QUIT 平滑终止</li><li>USR1 重新打开日志文件</li><li>USR2 平滑重载所有worker进程并重新载入配置和二进制模块</li></ul></li><li><p>关闭php-fpm： kill -INT cat /usr/local/php/var/run/php-fpm.pid</p></li><li><p>平滑重启php-fpm: kill -USR2 cat /usr/local/php/var/run/php-fpm.pid</p></li></ul>',26),n=[l];function P(s,o){return a(),e("div",null,n)}const m=p(h,[["render",P],["__file","cgi对比fastcgi以及php-cgi和php-fpm之间的联系区别.html.vue"]]);export{m as default};
